{% set hasMeeting = True if existingmeeting is defined else False %}
<form role="form" name="meeting" method="POST">
  <fieldset {% if semester.locked %}disabled="disabled"{% endif %}>
{% if hasMeeting %}
  <input type="hidden" name="action" value="updatemeeting"/>
{% else %}
  <input type="hidden" name="action" value="addmeeting"/>
{% endif %}
  <div class="row">
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="form-group">
        <input title="Del av läger" class="hike-tgl checkbox big-checkbox" name="ishike" id="mhike" type="checkbox"
               {% if hasMeeting and existingmeeting.getishike() %}checked{% endif %}/>
        </input>
        <label for="mhike">Del av läger</label>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="form-group">
        <label for="mname">Namn</label>
        <input type="text" class="form-control" placeholder="Mötesnamn" name="name" id="mname" value="{% if hasMeeting %}{{existingmeeting.getname()}}{% endif %}"/>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="form-group">
        <label for="mdate">Datum (termin {{semester.getname()}})</label>
        <input type="date" class="form-control" name="date" id="mdate" value="{% if hasMeeting %}{{existingmeeting.getdate()}}{% endif %}" min="{{semester.getMinDateStr()}}" max="{{semester.getMaxDateStr()}}"/>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="form-group">
        <label for="starttime">Starttid</label>
        <input type="time" class="form-control" name="starttime" id="starttime" value="{% if hasMeeting %}{{existingmeeting.gettime()}}{% endif %}"/>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="form-group">
        <label for="mduration">Längd (minuter)</label>
        <input type="number" class="form-control" name="duration" id="mduration" value="{% if hasMeeting %}{{existingmeeting.duration}}{% endif %}"/>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="form-group">
        <label for="mstoptime">Sluttid (för att räkna ut minuter)</label>
        <input type="time" class="form-control" id="mstoptime" />
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      {% if not hasMeeting %}
        $("#mdate").val(getTodaysDateString());
      {% endif %}

      $("#mstoptime").change(function() {
          var from = $("#starttime").val();
          var to = $( this ).val();


          var startTime = new Date('2012/10/09 ' + from);
          var endTime = new Date('2012/10/09 ' + to);
          var difference = endTime.getTime() - startTime.getTime(); // This will give difference in milliseconds
          var resultInMinutes = Math.round(difference / 60000);

          $("#mduration").val(resultInMinutes);
      });

      $("#mduration").change(function() {
          var from = $("#starttime").val();
          var value = $( this ).val();

          var startTime = new Date('2012/10/09 ' + from);

          var newDateObj = new Date(startTime.getTime() + value*60000);

          var hours = addZero(newDateObj.getHours());
          var minutes = addZero(newDateObj.getMinutes());

          $("#mstoptime").val(hours + ':' + minutes);
      });

      function addZero(i) {
          if (i < 10) {
              i = "0" + i;
          }
          return i;
      }

      $("#mduration").change();

      $('#mishike').click(function(event) {
        var hikeChecked = this.checked;
        if (hikeChecked) {
          $("#mname").val("Läger");
          $("#starttime").val("00:00");
          $("#mduration").val("1440");
        } else {
          $("#mname").val("Möte");
          $("#starttime").val("{{troop.defaultstarttime}}");
          $("#mduration").val("{{troop.defaultduration}}");
        };
      });
    });
  </script>
  <div class="row">
    <div class="col-xs-12">
      <button {% if semester.locked %}disabled="disabled"{% endif %} type="submit" name="submit" class="btn btn-lg btn-primary">{% if hasMeeting %}Spara{% else %}Lägg till{% endif %}</button>
    </div>
  </div>
  </fieldset>
</form>
{% if hasMeeting and semester.isOpen() %}
<hr/>
<form role="form" name="deletemeeting" method="POST">
  <input type="hidden" name="action" value="deletemeeting"/>
  <div class="btn-toolbar">
  <button type="submit" class="btn btn-lg btn-danger">Ta bort</button>
  </div>
</form>
{% endif %}
